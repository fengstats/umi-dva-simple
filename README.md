# ç”¨æˆ·ç®¡ç†

## å…ˆå¬æˆ‘è®²ä¸¤å¥

æŠ€æœ¯æ ˆï¼šUmi3 + dva + antd + proTable + TypeScript

åŠŸèƒ½ä¸å¤šï¼Œä¸»è¦æ˜¯å­¦ä¹  Umi3 å’Œ dva çš„é¡¹ç›®å¼€å‘æµç¨‹

è¿™æ˜¯åŸºäºå¼ ç«‹å¿—è€å¸ˆåœ¨bç«™çš„å…è´¹è¯¾ç¨‹å­¦ä¹ åï¼Œè‡ªå·±æ…¢æ…¢å®ç°çš„ï¼Œå‰å‰ååå› ä¸ºè¦ä¸Šç­çš„ç¼˜æ•…èŠ±è´¹äº†ä¸¤ä¸‰å¤©çš„æ—¶é—´ï¼Œï¼ˆè®²çœŸï¼çœŸçš„å¾ˆä¸é”™çš„ï¼Œè¾ƒä¸ºé€‚åˆæ–°æ‰‹å…¥é—¨ï¼‰ï¼Œæ„Ÿå…´è¶£çš„ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥è®¿é—®å­¦ä¹ å³å¯ï¼Œå†æ¬¡æ„Ÿè°¢å¼ è€å¸ˆï¼ï¼ï¼

å¯¹äº†ï¼Œè¿˜æƒ³è¡¥å……çš„ä¸€ç‚¹æ˜¯é¡¹ç›®çš„åå°æœåŠ¡ï¼Œå› ä¸ºæ•´ä½“çš„ä¸šåŠ¡é€»è¾‘æµç¨‹å¹¶ä¸å¤æ‚ï¼Œæ‰€ä»¥æˆ‘å°±ç›´æ¥ä½¿ç”¨ Node-RED è¿™ä¸ªå°å·¥å…·å®ç°äº†ä¸€ä¸‹ï¼Œç›®å‰ä¸å‡ºæ„å¤–çš„è¯éƒ¨ç½²åœ¨æˆ‘çš„ä¸ªäººæœåŠ¡å™¨ä¸Šï¼ˆçœ‹å¿ƒæƒ…ï¼ŒæŒ‡ä¸å®šå•¥æ—¶å€™åœäº†ï¼‰ï¼Œæ¥å£ä»£ç éƒ¨åˆ†åœ¨ src/pages/services ä¸‹ï¼Œä¸è¦æ…Œï½ js å®ç°çš„ï¼Œå½“ç„¶æˆ‘ä¹Ÿå¯¼å‡ºäº†ä¸€ä¸ª flows.json æ–‡ä»¶ï¼Œå¯ä»¥ç”¨äº Node-RED ç›´æ¥å¯¼å…¥ä½¿ç”¨

å¦‚æœå¯¹ Node-RED æ„Ÿå…´è¶£çš„ä¸‹æ–¹é“¾æ¥ä¹Ÿæœ‰ï¼Œå¾ˆæœ‰æ„æ€çš„ä¸€ä¸ªå°ç©æ„ï¼Œå¿«é€Ÿå®ç°ä½ çš„ä¸€äº›æƒ³æ³•ğŸ’¡

ä»£ç å†…éƒ¨è¯·æ±‚çš„åœ°å€å°±æ˜¯æˆ‘çš„äº‘æœåŠ¡æ¥å£åœ°å€ï¼Œå¯èƒ½å’Œå¼ è€å¸ˆå®ç°çš„æœ‰ç‚¹ä¸ä¸€æ ·ï¼ŒæŒ‰ç…§è‡ªå·±çš„æƒ³æ³•å†™çš„ï¼Œå˜¿å˜¿ï¼Œå¦‚æœä½ è¿æ°”å¥½ï¼Œåº”è¯¥èƒ½ç”¨...ï¼ˆä¸è¿‡æœ€å¥½è‡ªå·±æœ¬åœ°èµ·ä¸€ä¸ªè‡ªå·±æ…¢æ…¢ç©ï¼Œæ¯•ç«Ÿç©åˆ«äººçš„ä¸å¦‚è‡ªå·±å†™æœ‰æ„æ€ï¼Œæ˜¯å§ï¼Ÿï¼‰ğŸ¶

[å¼ è€å¸ˆè¯¾ç¨‹åœ°å€](https://www.aspirantzhang.com/dva3.html)

[Node-RED](https://nodered.org/)

## å¿«é€Ÿå¼€å§‹

```bash
# å®‰è£…ä¾èµ–
$ yarn

# å¯åŠ¨æœåŠ¡
$ yarn start
```

## é¢„è§ˆæˆªå›¾

### ç”¨æˆ·åˆ—è¡¨

![](./resource/01-userList.png)

### æ–°å¢ç”¨æˆ·

![](./resource/02-userAdd.png)

### ç¼–è¾‘ç”¨æˆ·

![](./resource/03-userEdit.png)

### åˆ é™¤ç”¨æˆ·

![](./resource/04-userDel.png)

### åˆ é™¤ç”¨æˆ·

## ç”¨æˆ·ç›®å½•è§„åˆ’

### users

- index.tsx
- model.ts(å¦ˆæ–—)
- service.ts
- components/UserModal.tsx(æ‘¸æ–—)

## Dva

### æ•°æ®æµæ¦‚å¿µ

- å…¬å…±æ•°æ®
- ç§æœ‰æ•°æ®
- åŒæ­¥æ•°æ®: Reducer æ›´æ”¹ state çš„å”¯ä¸€æ¸ é“
- å¼‚æ­¥æ•°æ®: Effect

Redux Store State -> Model

- Subscription: é¡µé¢å±‚çº§, è®¢é˜…
- é¡µé¢å¯ä»¥ç›´æ¥é€šè¿‡ connect è°ƒç”¨ Reducer æ›´æ”¹ state
- ä¹Ÿå¯ä»¥é€šè¿‡ dispatch(æ´¾å‘) Effect -> Reducer, é€šè¿‡`put`å‡½æ•°
- Subscription ä¹Ÿå¯ä»¥é€šè¿‡ dispatch(æ´¾å‘) Effect

Effect æ‹†åˆ†

- Service: æœåŠ¡

## antd

### Form

- initialValues: åªæœ‰åˆå§‹åŒ–ä»¥åŠé‡ç½®æ—¶ç”Ÿæ•ˆ,ä¸èƒ½è¢« setState åŠ¨æ€æ›´æ–°,éœ€è¦ä½¿ç”¨ setFieldsValue æ›´æ–°

## proTable

```shell
npm i @ant-design/pro-table --save
# æˆ–è€…
yarn add @ant-design/pro-table --save
```

## DatePicker ä¸èƒ½ç”¨ä½œ JSX ç»„ä»¶

è‡ªå·±æ‰¾æ‰¾å¯¹åº” @types/react ç‰ˆæœ¬ä¸ ts ç‰ˆæœ¬ä¾èµ–å…³ç³», é€‰æ‹©å…¶ä¸€å‡çº§

https://www.npmjs.com/package/@types/react